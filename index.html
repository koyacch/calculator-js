<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>dentakku</title>
  <style type="text/css">
  
    body{
      font-family: 'Avenir Next', sans-self;
    }
    div,span{
      box-sizing: border-box;
    }
    .container{
      padding: 20px;
    }
    .wrap{
      background-color: #000;
      width: 320px;
      border-radius: 10px;
      margin: 0 auto;
      padding: 20px;
    }
    .wrap-result,
    .wrap-cal{
      border: 1px solid  #666;
      border-radius: 4px;
      padding: 10px;
    }
    .wrap-result{
      margin-bottom: 10px;
    }
    .wrap-result > div{
      background-color: #fff;
      border-radius: 3px;
      line-height: 36px;
      font-size: 36px;
      text-align: right;
      padding: 10px;
    }
    .wrap-cal{
      font-size: 0;
    }
    .wrap-cal > div{
      display: inline-block;
      padding: 4px;
      vertical-align: top;
    }
    .cal-left{
      width: 75%;
    }
    div.cal-right{
      width: 25%;
      padding-left:0;
    }
    .wrap-cal > div >div{
      padding: 5px;
    }
    .wrap-cal span{
      color: #fff;
      font-size: 30px;
      background-color: #ccc;
      border-radius: 3px;
      text-align: center;
      padding: 10px;
      display: inline-block;
      width: 100%;
      line-height: 1;
      cursor: pointer;
      position: relative;
      top: 0;
      left: 0;
      user-select:none;
   }
   .wrap-cal span:hover{
     opacity: .8;
   }
   .wrap-cal span:active{
     top: 2px;
     left: 2px;
   }
    .cal-left > div{
      width: calc(100% / 3);
      display: inline-block;
    }
    div.clear-width,
    div.zero-width{
      width: 100%;
    }
    .cal-right span{
      background-color: #00c;
    }
    #cal-eq{
      background-color: #c00;
    }
  </style>
</head>

<body>
 <div class="container">
   <div class="wrap">
     <div class="wrap-result">
       <div id="result">0</div>
     </div>
     <div class="wrap-cal" id="cal-all">
       <div class="cal-left" id="cal-num">
         <div class="clear-width"><span id="cal-clear">C</span></div>
         <div><span id="cal-9">9</span></div>
         <div><span id="cal-8">8</span></div>
         <div><span id="cal-7">7</span></div>
         <div><span id="cal-6">6</span></div>
         <div><span id="cal-5">5</span></div>
         <div><span id="cal-4">4</span></div>
         <div><span id="cal-3">3</span></div>
         <div><span id="cal-2">2</span></div>
         <div><span id="cal-1">1</span></div>
         <div class="zero-width"><span id="cal-0">0</span></div>
       </div>
       <div class="cal-right">
         <div><span id="cal-divi">/</span></div>
         <div><span id="cal-multi">*</span></div>
         <div><span id="cal-sub">-</span></div>
         <div><span id="cal-add">+</span></div>
         <div><span id="cal-eq">=</span></div>
       </div>
     </div>
   </div>
 </div>
 
 <script type="text/javascript" >
   (function(){
     
     'use strict';
     
     // selecter
     var result = document.getElementById('result');
     
     // number type
     
     var calNum = document.getElementById('cal-num');
     var displayNum = 0;
     var calDigest = 10;
     
     // default possible key

     calNum.addEventListener('click', function(e){
       
       var setId = e.target.id;
       
       for(var i = 0; i < 10; i++){
          if(setId === "cal-" + i){
            if(Number(displayNum).toString().length < calDigest){
              displayNum += i.toString();
              result.textContent = addDisplay(displayNum);
              calStartFlag = false;
            }
          }
        }
     });
     
    // calc array
    var calcArray = [];
    
    // cal start flag
    var calStartFlag = true;
    
    // action add
    var calAdd = document.getElementById('cal-add');
    
    calAdd.addEventListener('click', function(){
      
      if(calStartFlag !== true){
        calcArray.push(Number(displayNum));
        displayNum = calcF(calcArray);
        result.textContent = addDisplay(displayNum);
        calcArray = [displayNum];
        displayNum = 0;
        calcArray.push("+");
        calStartFlag = true;
      }
      
    });
    
    // action sub
    var calSub = document.getElementById('cal-sub');
    
    calSub.addEventListener('click', function(){
      
      if(calStartFlag !== true){
        calcArray.push(Number(displayNum));
        displayNum = calcF(calcArray);
        result.textContent = addDisplay(displayNum);
        calcArray = [displayNum];
        displayNum = 0;
        calcArray.push("-");
        calStartFlag = true;
      }
      
    });
    
    // action multi
    var calMulti = document.getElementById('cal-multi');
    
    calMulti.addEventListener('click', function(){
      
      if(calStartFlag !== true){
        calcArray.push(Number(displayNum));
        displayNum = calcF(calcArray);
        result.textContent = addDisplay(displayNum);
        calcArray = [displayNum];
        displayNum = 0;
        calcArray.push("*");
        calStartFlag = true;
      }
      
    });
    
    // action divi
     var calDivi = document.getElementById('cal-divi');
    
    calDivi.addEventListener('click', function(){
      
      if(calStartFlag !== true){
        calcArray.push(Number(displayNum));
        displayNum = calcF(calcArray);
        result.textContent = addDisplay(displayNum);
        calcArray = [displayNum];
        displayNum = 0;
        calcArray.push("/");
        calStartFlag = true;
     }
      
    });
    
    // action equal
    var calEq = document.getElementById('cal-eq');
    
    calEq.addEventListener('click', function(){
      
      if(calStartFlag === false){
        calcArray.push(Number(displayNum));
        displayNum = calcF(calcArray);
        calcArray = [];
        result.textContent = addDisplay(displayNum);
      }
      
    });
    
    // action clear
    
    var calClear = document.getElementById('cal-clear');
    
    calClear.addEventListener('click', function() {
        
        displayNum = 0;
        result.textContent = addDisplay(displayNum);
        calcArray = [];
        calStartFlag = true;
        
    })
    
    // calculation
    
    function calcF(array){
      
      var calcResult = 0;
      calcResult = eval(array.join(""));
      console.log(array.join(""));
      return calcResult;
      
    }
    
    // result add comma
    
    function addDisplay(value){
      
      var result = "";
      var resultCamma = ""
      var resultNumber = Number(value).toString();
      var returnResult = [];
      var regexp = /^[0-9]+/;
      
      var isPeriod = resultNumber.indexOf(".");
      
      if(isPeriod !== -1){
        result = resultNumber.slice(0, isPeriod);
        resultCamma = resultNumber.slice(isPeriod);
      }
      else{
        result = resultNumber;
      }
      
      if(regexp.test(Number(result)) && Number.isInteger(Number(result)) ){
        var s = 0;
        var cammaResult = Number(result).toString().split("");
        for(var i = (cammaResult.length - 1);i >= 0; i--){
          if(s%3 === 0 && s !== 0){
            returnResult.unshift(","); 
          }
          returnResult.unshift(cammaResult[i]); 
          s++;
        }
        return returnResult.join("") + resultCamma;
      }
      else{
        return result + resultCamma;
      }
        
    }
 
   })();
 </script>
</body>

</html>
